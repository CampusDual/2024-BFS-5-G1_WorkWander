<div class="card-detalle">
  <div class="button-back">
    <o-button
      attr="iconposition3"
      icon="arrow_back_ios"
      (click)="goBack()"
    ></o-button>
  </div>
  <o-form
    #form
    attr="coworkingDetail"
    service="coworkings"
    entity="coworking"
    header-actions="R"
    show-header-navigation="no"
    keys="cw_id"
    keys-sql-types="integer"
    columns="cw_id;cw_name"
    header-position="false"
    layout-direction="row"
    detect-changes-on-blur="no"
    undo-button="no"
    stay-in-record-after-insert="true"
    editable-detail="no"
    (onDataLoaded)="showEvents(form.getFieldValue('cw_location'))"
  >
    <o-integer-input oHidden #id attr="cw_id"></o-integer-input>
    <o-integer-input oHidden #cw_location attr="cw_location"></o-integer-input>

    <div class="image-container">
      <!-- Campo para mostrar la imagen de coworking -->
      <div [ngClass]="{ hidden: !form.getFieldValue('cw_image') }">
        <!-- Ocultaremos el div cuando no exista "cw_image" -->
        <!-- Necesitamos el o-image para que se carge la imagen en el campo cw_image del form, sino no existiría el cw_image -->
        <o-image
          attr="cw_image"
          show-controls="no"
          read-only="yes"
          height="480px"
          width="450px"
          auto-fit="no"
        ></o-image>
      </div>
      <!-- En el caso de que no exista, cargaremos la imagen por defecto y se ocultará el div anterior -->
      <img
        *ngIf="!form.getFieldValue('cw_image')"
        src="assets/images/coworking-default.jpg"
        alt="Imagen predeterminada"
        height="480px"
        width="450px"
      />
    </div>

    <div class="info-container">
      <div>
        <o-text-input
          #name
          type="text"
          oHidden
          attr="cw_name"
          fxFlex
          label="NAME"
        ></o-text-input>
        <h1>{{ form.getFieldValue("cw_name") }}</h1>
      </div>

      <o-column class="detail-container">
        <o-text-input
          #location
          type="text"
          oHidden
          attr="location"
          fxFlex
          label="LOCATION"
        ></o-text-input>
        <p>
          <strong>{{ "LOCATION" | oTranslate }}:</strong>
          {{ form.getFieldValue("location") }}
        </p>

        <o-text-input
          #address
          type="text"
          oHidden
          attr="cw_address"
          fxFlex
          label="ADDRESS"
        ></o-text-input>
        <p>
          <strong>{{ "ADDRESS" | oTranslate }}:</strong>
          {{ form.getFieldValue("cw_address") }}
        </p>

        <o-text-input
          #description
          type="text"
          oHidden
          attr="cw_description"
          fxFlex
          label="DESCRIPTION"
        ></o-text-input>
        <p>
          <strong>{{ "DESCRIPTION" | oTranslate }}:</strong>
          {{ form.getFieldValue("cw_description") }}
        </p>
      </o-column>

      <div>
        <section class="services">
          <p>
            <strong>{{ "SERVICES" | oTranslate }}:</strong>
          </p>
          <o-grid
            #coworkingsGrid
            attr="coworkingsGrid"
            service="cw_services"
            entity="servicePerCoworking"
            keys="cw_id"
            columns="servicios"
            parent-keys="cw_id"
            quick-filter="no"
            fixed-header="no"
            controls="false"
            refresh-button="false"
            show-page-size="false"
            pagination-controls="false"
            show-buttons-text="no"
            cols="6"
            gutter-size="8px"
            rows="1"
            detail-mode="none"
            show-footer="no"
            grid-item-height="40px"
          >
            <o-grid-item *ngFor="let service of coworkingsGrid.dataArray">
              <mat-icon [matTooltip]="service.servicios | oTranslate">
                {{ serviceIcons[service.servicios] }}
              </mat-icon>
            </o-grid-item>
          </o-grid>
          <ng-container *ngIf="coworkingsGrid.dataArray.length === 0">
            <span class="coworking-service">{{
              "NO_SERVICES" | oTranslate
            }}</span>
          </ng-container>
        </section>
      </div>

      <o-column class="detail-container">
        <o-text-input
          #sites
          oHidden
          attr="cw_capacity"
          fxFlex
          label="CAPACITY"
        ></o-text-input>
        <p>
          <strong>{{ "CAPACITY" | oTranslate }}:</strong>
          {{ form.getFieldValue("cw_capacity") }} {{ "SEATS" | oTranslate }}
        </p>

        <div *ngIf="parsePermissions('date')">
          <p>
            <strong>{{ "DATE_RESERVATION" | oTranslate }}:</strong>
          </p>
          <o-form editable-detail="no" show-header="no">
            <!--Hay que añadir la funcion [min]  y value-type = date para desactivar las pasadas -->
            <o-daterange-input
              attr="daterange"
              #daterange
              fxFlex
              label="SELECT_DATE_RANGE"
              read-only="no"
              required="yes"
              [min]="currentDate()"
              (onValueChange)="setDates()"
              value-type="date"
            ></o-daterange-input>
          </o-form>
          <!-- Mostrar "Plazas Disponibles:"-->
          <p *ngIf="parsePermissions('realCapacity')">
            <strong>{{ "REAL_CAPACITY" | oTranslate }}: </strong>
          </p>
        </div>
      </o-column>

      <o-column class="price-container">
        <o-text-input
          #dailyPrice
          type="text"
          oHidden
          attr="cw_daily_price"
          fxFlex
          label="DAILY_PRICE"
        ></o-text-input>
        <div class="price">
          <strong>{{ "DAILY_PRICE" | oTranslate }}: </strong>
          <span
            [innerHTML]="formatPrice(form.getFieldValue('cw_daily_price'))"
          ></span>
        </div>
      </o-column>
      <o-column>
        <div class="columna-imagen-map">
          <!-- Map Information -->
          <div title="" fxLayoutGap="24px" class="map-container">
            <o-map
              #coworking_map
              attr="coworking_map"
              [center]="center"
              [zoom]="zoom"
              min-zoom="3"
              max-zoom="20"
              zoom-control="yes"
              search-control="no"
              layer-panel-visible="no"
              fxFlex
            >
            </o-map>
          </div>
        </div>
      </o-column>

      <div class="reservation-button" *ngIf="parsePermissions('bookingButton')">
        <o-button
          #bookingButton
          attr="bookingButton"
          label="{{ 'BOOKING' | oTranslate }}"
          type="raised"
          color="primary"
          (click)="showConfirm($event)"
          enabled="FALSE"
        ></o-button>
      </div>
    </div>
  </o-form>
  <!-- Carrusel que muestra los eventos -->
  <div id="carousel">
    <div class="card" *ngIf="events.length > 0">
      <p-carousel
        [value]="events"
        [numVisible]="3"
        [numScroll]="1"
        [circular]="true"
        [responsiveOptions]="responsiveOptions"
        [autoplayInterval]="5000"
      >
        <ng-template pTemplate="header">
          <strong>{{ "NEAR_EVENTS" | oTranslate }}</strong>
        </ng-template>
        <ng-template let-event pTemplate="item">
          <div class="event-item" (click)="goEvent(event.id_event)">
            <div class="event-item-content">
              <div>
                <img
                  [src]="getImageSrc(event.image_event)"
                  alt="{{ event.name }}"
                  class="event-image"
                />
              </div>
              <div>
                {{ event.name }}
                <br />
                <mat-icon>calendar_month</mat-icon>
                {{ dateTransform(event.date_event) }}
                <br />
                <mat-icon>access_time</mat-icon>
                {{ timeTransform(event.hour_event) }}
              </div>
            </div>
          </div>
        </ng-template>
      </p-carousel>
    </div>
  </div>
</div>
